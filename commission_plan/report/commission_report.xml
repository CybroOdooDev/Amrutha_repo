<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_commission">
        <t t-call="web.html_container">
            <t t-call="web.internal_layout">
                <t t-foreach="docs" t-as="o">
                    <div class="oe_structure">
                        <div class="col-12 mb-4">
                            <img t-if="o.company_id.logo"
                                 t-att-src="image_data_uri(o.company_id.logo)"
                                 style="max-height: 45px;" alt="Logo"/>
                            <div class="oe_structure"></div>
                        </div>
                        <h2>COMMISSION PAYOUT</h2>
                        <table class="table table-sm">
                            <tr>
                                <td>
                                    <strong>Date of Sale:</strong>
                                </td>
                                <td>
                                    <span t-field="o.create_date"
                                          t-options='{"widget": "date"}'/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <strong>Seller/Buyer:</strong>
                                </td>
                                <td>
                                    <t t-if="o.x_studio_sellerlandlord_name and o.x_studio_buyertenant_name">
                                        <span t-field="o.x_studio_sellerlandlord_name"/>
                                        /
                                        <span t-field="o.x_studio_buyertenant_name"/>
                                    </t>
                                    <t t-elif="o.x_studio_sellerlandlord_name">
                                        <span t-field="o.x_studio_sellerlandlord_name"/>
                                    </t>
                                    <t t-elif="o.x_studio_buyertenant_name">
                                        <span t-field="o.x_studio_buyertenant_name"/>
                                    </t>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <strong>Property:</strong>
                                </td>
                                <td>
                                    <span t-field="o.x_studio_property_address"/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <strong>Category:</strong>
                                </td>
                                <td>
                                    <span t-field="o.company_id.name"/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <strong>Type:</strong>
                                </td>
                                <td>
                                    <span t-field="o.x_studio_opportunity_type_1"/>
                                </td>
                            </tr>
                            <!--                            <tr>-->
                            <!--                                <td>-->
                            <!--                                    <strong>TC Fee:</strong>-->
                            <!--                                </td>-->
                            <!--                                <td>Brokerage</td>-->
                            <!--                            </tr>-->
                            <tr>
                                <td>
                                    <strong>Agent:</strong>
                                </td>
                                <td>
                                    <span t-field="o.user_id.name"/>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <strong>Co-Agent:</strong>
                                </td>
                                <td>
                                    <t t-if="o.referer_id">
                                        <span t-field="o.referer_id.name"/>
                                    </t>
                                </td>
                            </tr>
                        </table>

                        <t t-if="o.company_id.is_calculate_commission">
                            <!-- Residential Commission Section -->
                            <h3>Commission to Lange Real Estate</h3>
                            <div style="width:80%">
                                <div style="display: grid; grid-template-columns: auto auto; gap: 5px; align-items: baseline;">
                                    <div style="text-align: left;">
                                        <strong>Amount:</strong>
                                    </div>
                                    <div style="text-align: right;">
                                        <span t-field="o.total_amount"
                                              t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                    </div>

                                    <div style="text-align: left;">
                                        <strong>Due From Agent to meet
                                            <br/>
                                            minimum
                                            commission requirement:
                                        </strong>
                                    </div>
                                    <div style="text-align: right;">
                                        <span t-field="o.commission_to_be_converted_by_agent"
                                              t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                    </div>

                                    <div style="text-align: left;">
                                        <strong>External Referral Fee:</strong>
                                    </div>
                                    <div style="text-align: right;">
                                        <span t-field="o.external_referral_fee"
                                              t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                    </div>

                                    <div style="text-align: left; margin-top: 8px;">
                                        <strong>Total:</strong>
                                    </div>
                                    <div style="text-align: right; margin-top: 8px;">
                                        <span t-esc="o.total_amount + o.commission_to_be_converted_by_agent - o.external_referral_fee"
                                              t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                    </div>
                                </div>
                            </div>

                            <h3>Distributions to Agents</h3>
                            <table class="table table-sm">
                                <tr>
                                    <td>
                                        <strong>Tier:</strong>
                                    </td>
                                    <td><span t-field="o.tier"/>%
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Commission Earned:</strong>
                                    </td>
                                    <td>
                                        <span t-field="o.total_commission"
                                              t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Minimum Commission Due:
                                        </strong>
                                    </td>
                                    <td>
                                        <span
                                                t-field="o.commission_to_be_converted_by_agent"
                                                t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Internal Referral
                                            Fee:
                                        </strong>
                                    </td>
                                    <td>
                                        <span t-field="o.referral_fee"
                                              t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Transaction Coordinator Fee:
                                        </strong>
                                    </td>
                                    <td>
                                        <t t-if="o.is_apply_transaction_coordinator_fee">
                                            <span
                                                    t-field="o.transaction_coordinator_fee"
                                                    t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                        </t>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Payable to Agent:</strong>
                                    </td>
                                    <td>
                                        <span
                                                t-field="o.commission_to_be_paid"
                                                t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>
                                    </td>
                                </tr>
                            </table>
                        </t>
                        <t t-elif="o.company_id.is_calculate_commercial_commission">
                            <!-- Commercial Commission Section -->
                            <h3>Commission to Lange Real Estate</h3>
                            <p>
                                <strong>Amount:</strong>
                                <span t-field="o.planned_revenue"/>
                                <span t-field="o.currency_id.symbol"/>
                            </p>

                            <h3>Distributions to Agents</h3>
                            <table class="table table-sm">
                                <tr>
                                    <td>
                                        <strong>Tier:</strong>
                                    </td>
                                    <td>
                                        <span t-esc="o.agent_payout_tier * 100"/>
                                        %
                                    </td>
                                </tr>

                                <tr>
                                    <td>
                                        <strong>Commission Earned:</strong>
                                    </td>
                                    <td>
                                        <span t-field="o.total_commercial_commission"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Referral Fee:</strong>
                                    </td>
                                    <td>
                                        <span t-field="o.external_referral_fee"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Transaction Coordinator Fee:
                                        </strong>
                                    </td>
                                    <td>
                                        <!-- Always 0 for Commercial Commission -->
                                        <span>0</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Errors and Omissions
                                            Insurance:
                                        </strong>
                                    </td>
                                    <td>
                                        <span t-field="o.errors_omission_fee"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <strong>Payable to Agent:</strong>
                                    </td>
                                    <td>
                                        <span t-field="o.total_commercial_commission_earned"/>
                                    </td>
                                </tr>
                            </table>
                        </t>

                        <h3>Referral Fee Payable to Co-Agent</h3>
                        <p>
                            <strong>Amount:</strong>
                            <span t-field="o.referral_fee"/>
                        </p>

                        <!--                        <h3>Paid through Payroll</h3>-->
                        <!--                        <p>-->
                        <!--                            <strong>Transaction Coordinator:</strong>-->
                        <!--                            <t t-if="o.company_id.is_calculate_commission">-->
                        <!--                                <span t-field="o.company_id.tc_fee"/>-->
                        <!--                            </t>-->
                        <!--                            <t t-elif="o.company_id.is_calculate_commercial_commission">-->
                        <!--                                <span>0</span>-->
                        <!--                            </t>-->
                        <!--                        </p>-->

                        <p>All payments will be net of any outstanding charges
                            on agents' accounts.
                        </p>
                    </div>
                </t>
            </t>
        </t>
    </template>
</odoo>